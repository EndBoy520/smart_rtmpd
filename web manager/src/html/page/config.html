<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>服务器配置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
        .layui-form-item .layui-input-company {width: auto;padding-right: 10px;line-height: 38px;}
        .layui-form-label {width: 100px;}
        .layui-input-block {margin-left: 130px;}
        .layui-field-title {position: relative;}
        .layui-form-item-onoff {display: none;}
        .layui-elem-field legend {margin-left: 0;}
        input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {
        /* WebKit browsers */
            color: #ddd;
        }
        .btn-onoff2 {
            position: absolute;
            right: -5px;
            top: 0px;
        }
        @media screen and (max-width: 450px){
            .layui-form-item .layui-input-inline {
                margin: 0 0 10px 133px;
            }
            .layui-form-item .layui-input-inline+.layui-form-mid {
                margin-left: -5px;
                float: left;
            }
            .layui-form-item .layui-input-inline-float {
                margin: 0 10px 10px 0px;
                float: left;
            }
            .layui-form-item .layui-input-company {
                margin: 0 0 10px 0px;
                float: left;
            }
            .layui-form-item .layui-word-aux {
                display: none;
            }
        }
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">

        <form class="layui-form" action="" lay-filter="config">
            <!-- RTMP 配置 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>
                    <a class="btn-onoff" data-onoff="0" href="javascript:void(0);">
                        <i class="layui-icon">&#xe602;</i>
                        <span class="i18n" data-lang="config_rtmp_config">RTMP 配置</span>
                    </a>
                </legend>
            </fieldset>
            <div class="layui-form-item-onoff">
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_port">RTMP 端口</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="rtmp_port" lay-verify="number" value="1935" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_ssl">SSL 开关</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtmp_ssl" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_gop_cache">GOP缓存</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtmp_gop_cache" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">ChunkSize</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="rtmp_chunk_size" lay-verify="number" value="128" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_has_rtsp">转 RTSP</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtmp_has_rtsp" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_has_hls">转 HTTP-HLS</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtmp_has_hls" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_has_dash">转 HTTP-DASH</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtmp_has_dash" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_has_webrtc">转 WEBRTC</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtmp_has_webrtc" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_has_srt">转 SRT</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtmp_has_srt" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtmp_max_idle">流空闲时间</label>
                    <div class="layui-input-inline layui-input-inline-float" style="width: 80px;">
                        <input type="text" name="rtmp_max_idle" lay-verify="number" value="10" class="layui-input">
                    </div>
                    <div class="layui-input-inline layui-input-company i18n" data-lang="common_second">秒</div>
                    <div class="layui-form-mid layui-word-aux i18n" data-lang="config_rtmp_max_idle_desc">超过空闲时间，系统断开</div>
                </div>
            </div>

            <!-- HTTP 配置 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>
                    <a class="btn-onoff" data-onoff="0" href="javascript:void(0);">
                        <i class="layui-icon">&#xe602;</i>
                        <span class="i18n" data-lang="config_http_config">HTTP 配置</span>
                    </a>
                </legend>
            </fieldset>
            <div class="layui-form-item-onoff">
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_port">HTTP 端口</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="http_port" lay-verify="number" value="8080" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_enable">HTTP 开关</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="http_enable" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_sport">HTTPS 端口</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="http_sport" lay-verify="number" value="8181" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_ssl">SSL 开关</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="http_ssl" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_io_shrink">IO 抖动大小</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="http_io_shrink" lay-verify="number" value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_hls_count">HLS 切片个数</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="http_hls_count" lay-verify="number" value="3" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_hls_duration">HLS 切片时长</label>
                    <div class="layui-input-inline layui-input-inline-float" style="width: 80px;">
                        <input type="text" name="http_hls_duration" lay-verify="number" value="5" class="layui-input">
                    </div>
                    <div class="layui-input-inline layui-input-company i18n" data-lang="common_second">秒</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_hls_cache">HLS 缓存个数</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="http_hls_cache" lay-verify="number" value="6" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_dash_duration">DASH 切片时长</label>
                    <div class="layui-input-inline layui-input-inline-float" style="width: 80px;">
                        <input type="text" name="http_dash_duration" lay-verify="number" value="6" class="layui-input">
                    </div>
                    <div class="layui-input-inline layui-input-company i18n" data-lang="common_second">秒</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_dash_cache">DASH 缓存个数</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="http_dash_cache" lay-verify="number" value="12" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_rec_period">录像切片时长</label>
                    <div class="layui-input-inline layui-input-inline-float" style="width: 80px;">
                        <input type="text" name="http_rec_period" lay-verify="number" value="3" class="layui-input">
                    </div>
                    <div class="layui-input-inline layui-input-company i18n" data-lang="common_minute">分钟</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_http_rec_mode">录像模式</label>
                    <div class="layui-input-block">
                        <input type="radio" name="http_rec_mode" value="0" title="HLS 模式" checked="">
                        <input type="radio" name="http_rec_mode" value="1" title="DASH 模式">
                    </div>
                </div>
            </div>

            <!-- RTSP 配置 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>
                    <a class="btn-onoff" data-onoff="0" href="javascript:void(0);">
                        <i class="layui-icon">&#xe602;</i>
                        <span class="i18n" data-lang="config_rtsp_config">RTSP 配置</span>
                    </a>
                </legend>
            </fieldset>
            <div class="layui-form-item-onoff">
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtsp_port">RTSP 端口</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="rtsp_port" lay-verify="number" value="8554" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtsp_enable">RTSP 开关</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtsp_enable" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtsp_ssl">SSL 开关</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtsp_ssl" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtsp_has_rtmp">转 RTMP</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="rtsp_has_rtmp" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_rtsp_max_idle">流空闲时间</label>
                    <div class="layui-input-inline layui-input-inline-float" style="width: 80px;">
                        <input type="text" name="rtsp_max_idle" lay-verify="number" value="10" class="layui-input">
                    </div>
                    <div class="layui-input-inline layui-input-company i18n" data-lang="common_second">秒</div>
                    <div class="layui-form-mid layui-word-aux i18n" data-lang="config_rtsp_max_idle_desc">超过空闲时间，系统断开</div>
                </div>
            </div>

            <!-- SRT 配置 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>
                    <a class="btn-onoff" data-onoff="0" href="javascript:void(0);">
                        <i class="layui-icon">&#xe602;</i>
                        <span class="i18n" data-lang="config_srt_config">SRT 配置</span>
                    </a>
                </legend>
            </fieldset>
            <div class="layui-form-item-onoff">
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_srt_port">SRT 端口</label>
                    <div class="layui-input-inline" style="width: 80px;">
                        <input type="text" name="srt_port" lay-verify="number" value="9000" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_srt_enable">SRT 开关</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="srt_enable" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_srt_has_rtmp">转 RTMP</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="srt_has_rtmp" lay-skin="switch" lay-filter="switchTest" lay-text="开启|关闭">
                    </div>
                </div>
            </div>

            <!-- SSL 配置 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>
                    <a class="btn-onoff" data-onoff="0" href="javascript:void(0);">
                        <i class="layui-icon">&#xe602;</i>
                        <span class="i18n" data-lang="config_ssl_config">SSL 配置</span>
                    </a>
                </legend>
            </fieldset>
            <div class="layui-form-item-onoff" style="display: none;">
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_ssl_ca">CA 配置</label>
                    <div class="layui-input-inline">
                        <input type="text" name="ssl_ca" lay-verify="" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline">
                        <button type="button" class="layui-btn i18n" data-lang="config_ssl_select_file" id="ssl_ca">选择文件</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_ssl_server_key">服务器私钥</label>
                    <div class="layui-input-inline">
                        <input type="text" name="ssl_server_key" lay-verify="" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline">
                        <button type="button" class="layui-btn i18n" data-lang="config_ssl_select_file" id="ssl_server_key">选择文件</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_ssl_server_cert">服务器证书</label>
                    <div class="layui-input-inline">
                        <input type="text" name="ssl_server_cert" lay-verify="" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline">
                        <button type="button" class="layui-btn i18n" data-lang="config_ssl_select_file" id="ssl_server_cert">选择文件</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_ssl_client_key">客户端私钥</label>
                    <div class="layui-input-inline">
                        <input type="text" name="ssl_client_key" lay-verify="" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline">
                        <button type="button" class="layui-btn i18n" data-lang="config_ssl_select_file" id="ssl_client_key">选择文件</button>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_ssl_client_cert">客户端证书</label>
                    <div class="layui-input-inline">
                        <input type="text" name="ssl_client_cert" lay-verify="" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline">
                        <button type="button" class="layui-btn i18n" data-lang="config_ssl_select_file" id="ssl_client_cert">选择文件</button>
                    </div>
                </div>
            </div>

            <!-- NAT 配置 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>
                    <a class="btn-onoff" data-onoff="0" href="javascript:void(0);">
                        <i class="layui-icon">&#xe602;</i>
                        <span class="i18n" data-lang="config_nat_config">NAT 配置</span>
                    </a>
                </legend>
            </fieldset>
            <div class="layui-form-item-onoff" style="display: none;">
                <div class="layui-form-item">
                    <label class="layui-form-label">RTMP</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nat_rtmp" placeholder="192.168.1.1:1935" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">RTSP</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nat_rtsp" placeholder="192.168.1.1:554" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">HTTP</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nat_http" placeholder="192.168.1.1:8080" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">HTTPS</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nat_https" placeholder="192.168.1.1:8181" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">SRT</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nat_srt" placeholder="192.168.1.1:9000" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">RTP</label>
                    <div class="layui-input-inline">
                        <input type="text" name="nat_rtp" placeholder="192.168.1.1" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <!-- 全局配置 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>
                    <a class="btn-onoff" data-onoff="0" href="javascript:void(0);">
                        <i class="layui-icon">&#xe602;</i>
                        <span class="i18n" data-lang="config_global_config">全局配置</span>
                    </a>
                </legend>
            </fieldset>
            <div class="layui-form-item-onoff">
                <div class="layui-form-item">
                    <label class="layui-form-label required i18n" data-lang="config_global_auth_url">鉴权地址</label>
                    <div class="layui-input-block global-auth-url">
                        <input type="text" name="global_auth_url" lay-verify="" lay-reqtext="" placeholder="请输入鉴权地址"  value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label i18n" data-lang="config_global_rtp">RTP 端口范围</label>
                    <div class="layui-input-inline layui-input-inline-float" style="width: 80px;">
                        <input type="text" name="global_rtp_min" placeholder="min 3000" lay-verify="number" value="3000" class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-input-inline-float">-</div>
                    <div class="layui-input-inline layui-input-inline-float" style="width: 80px;">
                        <input type="text" name="global_rtp_max" placeholder="max 60000" lay-verify="number" value="60000" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-normal i18n" data-lang="common_save" lay-submit lay-filter="setting">保存</button>
                    <button type="button" class="layui-btn btn-refresh">
                        <!-- <i class="fa fa-refresh margin-right-10"></i> -->
                        <span class="i18n" data-lang="common_refresh">刷新</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="../js/lay-config.js?v=2.0.0" charset="utf-8"></script>
<script src="../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="../js/jquery.i18n.properties-min-1.0.9.js" charset="utf-8"></script>
<script src="../js/common.js" charset="utf-8"></script>
<script>
    layui.use(['form', 'jquery', 'request', 'upload'], function() {
        var $ = layui.jquery,
            form = layui.form,
            layer = layui.layer,
            upload = layui.upload,
            request = layui.request,
            ssl = {
                ca: null,
                server_key: null,
                server_cert: null,
                client_key: null,
                client_cert: null,
            };

        window.lang.render(); // 国际化

        // 刷新按钮
        $('.btn-refresh').on('click', function() {
            getData();
        });

        $('.btn-onoff').on('click', function() {
            let $this = $(this),
                $content = $this.parent().parent().next();
                onoff = $this.attr('data-onoff');

            if (onoff === '0') {
                $content.slideToggle();
                $this.attr('data-onoff', '1');
                $this.find('i').html('&#xe61a;');
            } else {
                $content.slideToggle();
                $this.attr('data-onoff', '0');
                $this.find('i').html('&#xe602;');
            }
        });

        // CA 配置文件
        upload.render({
            elem: '#ssl_ca',
            url: 'https://httpbin.org/post',
            auto: false,
            accept: 'file',
            choose: function(obj) {
                var files = obj.pushFile();
                
                obj.preview(function(index, file, result){
                    ssl.ca = file;
                    console.log('ssl=', ssl);
                    // $('input[name="ssl_ca"]').val(file.name);
                });
            }
        });

        // 服务器私钥文件
        upload.render({
            elem: '#ssl_server_key',
            url: 'https://httpbin.org/post',
            auto: false,
            accept: 'file',
            choose: function(obj) {
                var files = obj.pushFile();
                obj.preview(function(index, file, result){
                    ssl.server_key = file;
                    console.log('ssl=', ssl);
                    // $('input[name="ssl_server_key"]').val(file.name);
                });
            }
        });

        // 服务器证书文件
        upload.render({
            elem: '#ssl_server_cert',
            url: 'https://httpbin.org/post',
            auto: false,
            accept: 'file',
            choose: function(obj) {
                var files = obj.pushFile();
                obj.preview(function(index, file, result){
                    ssl.server_cert = file;
                    console.log('ssl=', ssl);
                    // $('input[name="ssl_server_cert"]').val(file.name);
                });
            }
        });

        // 客户端私钥文件
        upload.render({
            elem: '#ssl_client_key',
            url: 'https://httpbin.org/post',
            auto: false,
            accept: 'file',
            choose: function(obj) {
                var files = obj.pushFile();
                obj.preview(function(index, file, result){
                    ssl.client_key = file;
                    console.log('ssl=', ssl);
                    // $('input[name="ssl_client_key"]').val(file.name);
                });
            }
        });

        // 客户端证书文件
        upload.render({
            elem: '#ssl_client_cert',
            url: 'https://httpbin.org/post',
            auto: false,
            accept: 'file',
            choose: function(obj) {
                var files = obj.pushFile();
                obj.preview(function(index, file, result){
                    ssl.client_cert = file;
                    console.log('ssl=', ssl);
                    // $('input[name="ssl_client_cert"]').val(file.name);
                });
            }
        });

        //监听提交
        form.on('submit(setting)', function(data) {

            let info = data.field;

            let params = {
                "global": {
                    "auth_url": info.global_auth_url,
                    "rtp_min": info.global_rtp_min ? +info.global_rtp_min : info.global_rtp_min,
                    "rtp_max": info.global_rtp_max ? +info.global_rtp_max : info.global_rtp_max
                },
                "nat": {
                    "rtmp": info.nat_rtmp,
                    "rtsp": info.nat_rtsp,
                    "http": info.nat_http,
                    "https": info.nat_https,
                    "srt": info.nat_srt,
                    "rtp": info.nat_rtp,
                },
                "ssl": {
                    "ca": info.ssl_ca,
                    "server_key": info.ssl_server_key,
                    "server_cert": info.ssl_server_cert,
                    "client_key": info.ssl_client_key,
                    "client_cert": info.ssl_client_cert,
                },
                "rtmp": {
                    "port": info.rtmp_port ? +info.rtmp_port : info.rtmp_port,
                    "ssl": !!info.rtmp_ssl,
                    "gop_cache": !!info.rtmp_gop_cache,
                    "chunk_size": info.rtmp_chunk_size ? +info.rtmp_chunk_size : info.rtmp_chunk_size,
                    "has_rtsp": !!info.rtmp_has_rtsp,
                    "has_hls": !!info.rtmp_has_hls,
                    "has_dash": !!info.rtmp_has_dash,
                    "has_webrtc": !!info.rtmp_has_webrtc,
                    "has_srt": !!info.rtmp_has_srt,
                    "max_idle": info.rtmp_max_idle ? +info.rtmp_max_idle : info.rtmp_max_idle,
                },
                "rtsp": {
                    "port": info.rtsp_port ? +info.rtsp_port : info.rtsp_port,
                    "enable": !!info.rtsp_enable,
                    "ssl": !!info.rtsp_ssl,
                    "max_idle": info.rtsp_max_idle ? +info.rtsp_max_idle : info.rtsp_max_idle,
                    "has_rtmp": !!info.rtsp_has_rtmp,
                },
                "http": {
                    "port": info.http_port ? +info.http_port : info.http_port,
                    "enable": !!info.http_enable,
                    "sport": info.http_sport ? +info.http_sport : info.http_sport,
                    "ssl": !!info.http_ssl,
                    "io_shrink": info.http_io_shrink ? +info.http_io_shrink : info.http_io_shrink,
                    "hls_count": info.http_hls_count ? +info.http_hls_count : info.http_hls_count,
                    "hls_duration": info.http_hls_duration ? +info.http_hls_duration : info.http_hls_duration,
                    "hls_cache": info.http_hls_cache ? +info.http_hls_cache : info.http_hls_cache,
                    "dash_duration": info.http_dash_duration ? +info.http_dash_duration : info.http_dash_duration,
                    "dash_cache": info.http_dash_cache ? +info.http_dash_cache : info.http_dash_cache,
                    "rec_mode": info.http_rec_mode ? +info.http_rec_mode : info.http_rec_mode,
                    "rec_period": info.http_rec_period ? +info.http_rec_period : info.http_rec_period,
                },
                "srt": {
                    "port": info.srt_port ? +info.srt_port : info.srt_port,
                    "enable": !!info.srt_enable,
                    "has_rtmp": !!info.srt_has_rtmp,
                }
            }

            console.log('info=', info);
            console.log('params=', JSON.stringify(params));

            layer.confirm(window.lang.map.config_tips_save, {
                btn: [window.lang.map.common_enter, window.lang.map.common_cancel]
            }, function(){
                request.post({
                    url: '/config',
                    data: params,
                    success: function(res) {
                        let { code, msg, data } = res;
                        if (code === 0) {
                            layer.msg(msg);
                        } else {
                            layer.msg(JSON.stringify(msg));
                        }
                    }
                });
            }, function(){
                
            });
            return false;
        });

        function getData() {
            request.get({
                url: '/config',
                success: function(res) {
                    let { code, msg, data } = res;
                    if (code === 0) {
                        // 表单初始赋值
                        form.val('config', {
                            // global
                            global_auth_url: data.global.auth_url,
                            global_rtp_min: data.global.rtp_min,
                            global_rtp_max: data.global.rtp_max,

                            // nat
                            nat_rtmp: data.nat.rtmp,
                            nat_rtsp: data.nat.rtsp,
                            nat_http: data.nat.http,
                            nat_https: data.nat.https,
                            nat_srt: data.nat.srt,
                            nat_rtp: data.nat.rtp,

                            // ssl
                            ssl_ca: data.ssl.ssl_ca,
                            ssl_server_key: data.ssl.ssl_server_key,
                            ssl_server_cert: data.ssl.ssl_server_cert,
                            ssl_client_key: data.ssl.ssl_client_key,
                            ssl_client_cert: data.ssl.ssl_client_cert,

                            // rtmp
                            rtmp_port: data.rtmp.port,
                            rtmp_ssl: data.rtmp.ssl,
                            rtmp_gop_cache: data.rtmp.gop_cache,
                            rtmp_chunk_size: data.rtmp.chunk_size,
                            rtmp_has_rtsp: data.rtmp.has_rtsp,
                            rtmp_has_hls: data.rtmp.has_hls,
                            rtmp_has_dash: data.rtmp.has_dash,
                            rtmp_has_webrtc: data.rtmp.has_webrtc,
                            rtmp_has_srt: data.rtmp.has_srt,
                            rtmp_max_idle: data.rtmp.max_idle,

                            // rtsp
                            rtsp_port: data.rtsp.port,
                            rtsp_enable: data.rtsp.enable,
                            rtsp_ssl: data.rtsp.ssl,
                            rtsp_max_idle: data.rtsp.max_idle,
                            rtsp_has_rtmp: data.rtsp.has_rtmp,

                            // http
                            http_port: data.http.port,
                            http_enable: data.http.enable,
                            http_sport: data.http.sport,
                            http_ssl: data.http.ssl,
                            http_io_shrink: data.http.io_shrink,
                            http_hls_count: data.http.hls_count,
                            http_hls_duration: data.http.hls_duration,
                            http_hls_cache: data.http.hls_cache,
                            http_dash_duration: data.http.dash_duration,
                            http_dash_cache: data.http.dash_cache,
                            http_rec_period: data.http.rec_period,
                            http_rec_mode: data.http.rec_mode,

                            // srt
                            srt_port: data.srt.port,
                            srt_enable: data.srt.enable,
                            srt_has_rtmp: data.srt.has_rtmp,

                        });
                    } else {
                        layer.msg(JSON.stringify(msg));
                    }
                }
            });
        }
        getData();

    });
</script>
</body>
</html>